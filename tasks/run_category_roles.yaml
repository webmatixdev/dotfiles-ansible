---
- name: "Run {{ category_name }} roles"
  ansible.builtin.include_role:
    apply:
      tags:
        - "{{ role_name }}"
    name: "{{ category_name }}/{{ role_name }}"
  loop: "{{ (merged_roles[category_name] | default([])) | difference(exclude_roles | default([])) | map('string') | list }}"
  loop_control:
    loop_var: role_name
  when: 'exclude_categories | default([]) | select("search", "^" + category_name + "$") | list | length == 0'
